# AGENTS

This file is for agentic coding tools working in this repo.
Keep guidance short, concrete, and consistent with repo conventions.

## Environment

- Package manager: npm (see `package-lock.json`).
- App type: TanStack Start + Vite + React.
- Language: TypeScript (ESM, strict).
- Styling: Tailwind CSS.
- Auth: better-auth.
- Database: Drizzle ORM (Postgres).

## Commands

- Install: `npm install`.
- Dev server: `npm run dev`.
- Build: `npm run build`.
- Preview build: `npm run preview`.
- Lint (repo): `npm run lint`.
- Lint (single file): `npm run lint -- path/to/file.ts`.
- Format (repo): `npm run format`.
- Format (single file): `npm run format -- path/to/file.ts`.
- Format + lint fix: `npm run check`.
- Typecheck: `npm run typecheck`.
- Tests (all): `npm run test`.
- Single test file: `npm run test -- path/to/file.test.ts`.
- Single test by name: `npm run test -- -t "test name"`.
- Watch mode (Vitest default): `npx vitest`.
- DB generate: `npm run db:generate`.
- DB migrate: `npm run db:migrate`.
- DB push: `npm run db:push`.
- DB pull: `npm run db:pull`.
- DB studio: `npm run db:studio`.

### Testing notes

- Tests run via `vitest run` (`npm run test`).
- `@testing-library/react` and `@testing-library/dom` are available.
- `jsdom` is installed for DOM environments when needed.
- See `notes/testing.md` for manual test accounts.

## Project structure

- `src/routes`: TanStack file-based routing.
- `src/routes/__root.tsx`: root layout and document shell.
- `src/routeTree.gen.ts`: generated by TanStack Router; do not edit.
- `src/integrations`: TanStack Query + Better Auth integrations.
- `src/lib`: shared utilities (`cn`), auth client, helpers.
- `src/db`: database connection helpers and schema.
- `public`: static assets served by Vite.

## Code style

Formatting is enforced by Prettier and ESLint (TanStack config).
Follow existing patterns in nearby files when editing.

## File size & structure

- Prefer small, focused files with a single responsibility.
- If a file grows beyond ~200–300 lines, consider:
  - extracting helpers or hooks
  - splitting server vs client logic
  - moving reusable logic into `src/lib`
- Large React components should be decomposed into:
  - smaller presentational components
  - custom hooks for stateful logic
- Avoid “utility dumping grounds”; name extracted files by intent.
- Route files should stay thin:
  - routing + data loading only
  - move complex UI into colocated components
- Hooks should not mix data fetching, state, and formatting concerns.
- For component folders, use the component name as the folder name and keep the main component in `index.tsx`; keep subcomponents and utilities alongside it.

### Formatting rules (from `prettier.config.js`)

- No semicolons.
- Use single quotes in TS/JS.
- Trailing commas where valid.
- JSX attributes use double quotes (Prettier default).

### ESLint rules (from `eslint.config.js`)

- Base rules from `@tanstack/eslint-config`.
- Array types use `T[]` and `readonly T[]`.

### Imports

- Prefer ESM `import` syntax.
- Group imports with blank lines: external, internal, types.
- Use `import type` for type-only imports.
- Use the path alias `@/` for `src` imports.
- Keep relative imports for same-folder files when clearer.

### Naming

- React components: PascalCase.
- Hooks and functions: camelCase.
- Route files: follow TanStack Router file conventions.
- Keep filenames aligned with export names when practical.
- Constants: uppercase only when truly constant.

### Types

- TypeScript `strict` is enabled.
- Avoid `any` and keep types explicit at module boundaries.
- Prefer narrowing (`if`, early returns) to satisfy strict null checks.
- Use `interface` or `type` consistently within a module.

### TypeScript compiler options (from `tsconfig.json`)

- `noUnusedLocals` and `noUnusedParameters` are on.
- `noFallthroughCasesInSwitch` is on.
- `noUncheckedSideEffectImports` is on.
- `moduleResolution` uses `bundler`.
- `allowImportingTsExtensions` is enabled.

### Error handling

- Do not swallow errors; return or throw meaningful errors.
- For async work, handle promise rejections explicitly.
- Prefer early returns for guard clauses.
- Avoid side effects in module scope unless intentional.

### React + TanStack Router

- Routes export a `Route` constant created with `createFileRoute`.
- Root route uses `createRootRouteWithContext`.
- Keep router setup in `src/router.tsx`.
- Avoid editing `src/routeTree.gen.ts` (generated file).

### Styling

- Use Tailwind utility classes.
- Use `cn` from `src/lib/utils.ts` to merge conditional classes.
- Keep class lists readable; split long JSX props across lines.
- Prefer semantic HTML with Tailwind for layout and spacing.

### Auth

- Server-side auth config is in `src/lib/auth.ts`.
- Client auth uses `src/lib/auth-client.ts`.
- Access env vars via `process.env` only in server-side code.
- Prefer passing auth context rather than global state.

### Database

- Drizzle config lives in `drizzle.config.ts`.
- Keep schema in `src/db`.
- Use existing connection helpers (`src/db/pool.ts`).
- Run migrations via the npm scripts in this file.

## Generated and operational notes

- Do not modify `src/routeTree.gen.ts`.
- Keep generated files out of formatting or linting changes.
- Follow repo scripts before adding new tooling.
- If you add dependencies, update `package.json` and `package-lock.json`.
- When unsure, prefer minimal changes aligned with current patterns.
