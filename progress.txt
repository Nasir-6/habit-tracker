
- Task completed: Frontend / Habit Management - Render habit creation UI with a required name field.
- Decisions: inline creation card on Today page for now; save disabled when trimmed name empty; test script uses --passWithNoTests since no test files.
- Files changed: src/routes/index.tsx, package.json.
- Blockers/notes: vitest reports hanging process message after run.

- Task completed: Backend / Habit Management - Reject habit creation requests without a name.
- Decisions: add POST /api/habits handler with JSON parsing + trimmed name validation; return 201 with name only, no persistence yet.
- Files changed: src/routes/api/habits.ts, src/routeTree.gen.ts.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Calendar View - Display current and best streak above the calendar. (PRD Frontend / Calendar View)
- Decisions: reuse habitStreaks map from dashboard; show current/best cards under selected habit label; default 0 when missing.
- Files changed: src/components/dashboard/HabitCalendarCard.tsx, src/components/dashboard/Dashboard.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Calendar View - Allow navigation between months. (PRD Frontend / Calendar View)
- Decisions: add prev/next month controls in calendar card; shift month anchor to first of month to avoid date drift.
- Files changed: src/components/dashboard/HabitCalendarCard.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / History - Preserve historical data for archived habits. (PRD Backend / History)
- Decisions: added archived_at column for soft-archive; reuse PATCH /api/habits with archiveId to avoid new route; history continues to allow archived habits via existing lookup.
- Files changed: src/db/schema.ts, src/routes/api/habits.ts, drizzle/0005_add_habit_archived_at.sql, drizzle/meta/_journal.json, prd.json, progress.txt.
- Blockers/notes: vitest reports hanging process message after run.

- Task completed: Backend / Calendar View - Return completion dates scoped to habit and month.
- Decisions: add GET /api/calendar with habitId + YYYY-MM; validate month via UTC bounds; query completions within month only.
- Files changed: src/routes/api/calendar.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Persist session across refresh when the user is signed in. (PRD Frontend / Auth)
- Decisions: force one client-side session refetch on app mount; avoids stale SSR-null auth snapshot after hard refresh; keeps existing auth flow unchanged.
- Files changed: src/routes/index.tsx, prd.json, progress.txt.
- Blockers/notes: vitest still prints hanging-process shutdown warning though command exits 0.

- Task completed: Frontend / Partnering - Allow users to remove an active partner from the UI. (PRD Frontend / Partnering)
- Decisions: add remove action in active partner card with confirm guard; call existing DELETE /api/partnerships and clear local partner state immediately on success; keep inline success/error copy for user feedback.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/PartnerStatusCard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Auth - Create a session on successful sign-in. (PRD Backend / Auth)
- Decisions: confirmed better-auth handler + tanstackStartCookies handles session creation on sign-in; no extra server route needed.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Allow users to create an account with email and password. (PRD Frontend / Auth)
- Decisions: explicitly sign in after successful sign-up to ensure session and dashboard load immediately.
- Files changed: src/routes/index.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Render sign-in screen with email and password inputs. (PRD Frontend / Auth)
- Decisions: disable auth submit when email or password empty; keep existing auth submit validation for error messaging.
- Files changed: src/components/dashboard/AuthScreen.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Partnering - Display partner habit names and todayâ€™s completion status. (PRD Frontend / Partnering)
- Decisions: fetch partner status from /api/partnerships using local date; treat 404 as no partner; show completed pill per habit.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/PartnerStatusCard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / History - Render a read-only history view for a habit. (PRD Frontend / History)
- Decisions: inline per-habit history panel vs new route to avoid route tree changes; fetch on-demand from /api/history with today localDate; render dates as read-only YYYY-MM-DD pills.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Restrict partner visibility to post-partnership data only.
- Decisions: add GET /api/partnerships returning partner habits + today status; gate completion status when localDate < partnership startedOn; keep habit names visible regardless of start date.
- Files changed: src/routes/api/partnerships.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Calendar View - Ensure calendar data respects user local timezone.
- Decisions: accept optional tzOffsetMinutes query param (defaults 0); shift habit created/today bounds by offset; validate integer +/-14h.
- Files changed: src/routes/api/calendar.ts, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / Partnering - Allow either user to revoke partnership immediately.
- Decisions: add DELETE /api/partnerships to remove the current user's partnership by matching user id on either side; return 404 when none found.
- Files changed: src/routes/api/partnerships.ts, src/routes/api/streaks.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Activate partnership upon acceptance.
- Decisions: add partnerships table keyed by sorted user ids with started_at timestamp; accept via PATCH /api/partner-invites using inviteId, verify invitee email matches session user.
- Files changed: src/routes/api/partner-invites.ts, src/db/schema.ts, drizzle/0004_create_partnerships.sql, drizzle/meta/_journal.json, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Create a pending partnership invite.
- Decisions: add partner_invites table with pending status + unique inviter/invitee/status; POST /api/partner-invites validates email, prevents self-invite, onConflictDoNothing -> "Invite already pending".
- Files changed: src/db/schema.ts, drizzle/0003_create_partner_invites.sql, drizzle/meta/_journal.json, src/routes/api/partner-invites.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Streaks - Display current and best streak per habit.
- Decisions: fetch streaks per habit from /api/streaks using local YYYY-MM-DD; store streaks in separate map to avoid mutating habit list; default to 0 on fetch error.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / History - Return historical completion data for a habit.
- Decisions: add GET /api/history with habitId + localDate query; validate localDate and exclude future by lte on completedOn; return ordered date list.
- Files changed: src/routes/api/history.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Habit Management - Allow reordering of habits via drag-and-drop.
- Decisions: HTML5 drag events with optimistic reorder; persist order via PATCH /api/habits; rollback on error; reuse error banner.
- Files changed: src/routes/index.tsx.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Daily Check-in - Allow user to undo a habit completion for the current day.
- Decisions: toggle completion in local state; keep button active with undo label and completed styling.
- Files changed: src/routes/index.tsx.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Habit Management - Display newly created habits in the Today list.
- Decisions: submit to /api/habits and render response into local habit list; prepend new habit; show empty/drag hints conditionally; add lightweight error state.
- Files changed: src/routes/index.tsx.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Daily Check-in - Allow user to complete a habit for the current day.
- Decisions: store completion state in local habit list; disable completion control once marked to avoid undo in this task scope.
- Files changed: src/routes/index.tsx.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / Habit Management - Persist habit order per user.
- Decisions: add habits table with sort order + user id; require auth session for habit CRUD; add GET/PATCH on /api/habits for ordered fetch and updates.
- Files changed: src/db/schema.ts, src/routes/api/habits.ts.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Auth + DB plumbing - Enable email/password auth flow and apply habits table migration for local testing.
- Decisions: use absolute auth base URL on SSR and window origin on client; add habits migration and update journal for db:migrate.
- Files changed: src/lib/auth-client.ts, src/routes/index.tsx, drizzle/0001_create_habits.sql, drizzle/meta/_journal.json.
- Blockers/notes: none.

- Task completed: Backend / Streaks - Calculate current streak from consecutive daily completions.
- Decisions: new GET /api/streaks with habitId/localDate query; streak counts consecutive completions ending on provided localDate to zero-out missed days.
- Files changed: src/routes/api/streaks.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Daily Check-in - Remove or deactivate completion when undone.
- Decisions: add DELETE /api/completions with same payload validation + habit ownership check; return removed boolean after delete.
- Files changed: src/routes/api/completions.ts, prd.json.
- Blockers/notes: none.

- Task completed: Backend / Daily Check-in - Store a single completion per habit per local day.
- Decisions: create habit_completions table with unique (habit_id, completed_on); POST /api/completions expects habitId + localDate (YYYY-MM-DD), validates date, uses conflict-do-nothing to prevent duplicates.
- Files changed: src/db/schema.ts, src/routes/api/completions.ts, drizzle/0002_create_habit_completions.sql, drizzle/meta/_journal.json, prd.json.
- Blockers/notes: none.

- Task completed: Backend / Streaks - Reset current streak after a missed day while preserving best streak.
- Decisions: compute bestStreak from descending completion list while currentStreak continues to anchor on requested localDate; return bestStreak from /api/streaks response.
- Files changed: src/routes/api/streaks.ts, prd.json.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / Calendar View - Exclude dates before habit creation and after today.
- Decisions: clamp calendar query bounds between habit created date (UTC) and today (UTC) to avoid pre-creation/future dates; return empty list when range is invalid.
- Files changed: src/routes/api/calendar.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Habit Management - Reject habit creation requests without a name. (PRD Backend / Habit Management)
- Decisions: confirmed existing POST /api/habits validation already rejects missing/blank names before insert; marked PRD as passing.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Calendar View - Render a monthly calendar for a single habit. (PRD Frontend / Calendar View)
- Decisions: replace week preview card with calendar card; default to current month and first habit selection; show empty state when no habits.
- Files changed: src/components/dashboard/HabitCalendarCard.tsx, src/components/dashboard/Dashboard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Calendar View - Visually distinguish completed, missed, today, and future days. (PRD Frontend / Calendar View)
- Decisions: fetch calendar dates via /api/calendar with tzOffsetMinutes for local day mapping; derive status per YYYY-MM-DD and apply distinct Tailwind styles for completed/missed/today/future.
- Files changed: src/components/dashboard/HabitCalendarCard.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Platform - Ensure Today screen is usable on mobile viewports. (PRD Frontend / Platform)
- Decisions: added responsive padding + stacked layout; increased touch target sizes with min height and full-width buttons on small screens; hide Empty label when habits exist.
- Files changed: src/components/dashboard/PageShell.tsx, src/components/dashboard/CreateHabitCard.tsx, src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: vitest still reports hanging process message after run.

- Task completed: Backend / Platform - Support offline completions with eventual sync. (PRD Backend / Platform)
- Decisions: allow bulk completion payloads on POST /api/completions; rely on conflict-do-nothing to keep sync idempotent; validate habit ownership across batch before insert.
- Files changed: src/routes/api/completions.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Habit Management - Allow reordering of habits via drag-and-drop. + Backend / Habit Management - Persist habit order per user. (PRD updates)
- Decisions: mark PRD items as passing to reflect completed implementation already in repo.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Provide a visible sign-out action when a user is signed in. + Sign out clears session and returns user to the sign-in view. (PRD Frontend / Auth)
- Decisions: wire dashboard header sign-out to authClient.signOut with in-progress and inline error state; reset sign-out state on logout.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/DashboardHeader.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Auth - Restrict protected API routes to authenticated users. (PRD Backend / Auth)
- Decisions: confirmed all API routes use withAuth and session lookup via auth.api.getSession to return 401 when unauthenticated.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Auth - Reject sign-in with invalid credentials. (PRD Backend / Auth)
- Decisions: better-auth handler validates credentials and returns error on failed sign-in; no extra server route required.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Allow users to invite a partner from the UI. (PRD Frontend / Partnering)
- Decisions: add invite form to Partner card when no active partner; submit to existing /api/partner-invites endpoint; show inline success/error confirmation to close loop after submit.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/PartnerStatusCard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Habit Management - Delete a habit and its related data on request. (PRD Backend / Habit Management)
- Decisions: added DELETE /api/habits with habitId query for explicit intent; hard-delete habit row scoped by user and rely on FK cascade from habit_completions for related cleanup.
- Files changed: src/db/habits.ts, src/lib/api/habits.ts, src/routes/api/habits.ts, prd.json, progress.txt.
- Blockers/notes: vitest still prints hanging-process shutdown warning though command exits 0.

- Task completed: Frontend / Habit Management - Allow users to delete a habit from the UI. (PRD Frontend / Habit Management)
- Decisions: add inline Delete action per habit instead of a menu for minimal surface; require native confirm prompt before DELETE /api/habits; clear open history panel if deleted habit was selected.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Daily Check-in - Move completed habits to the bottom of the Today list. (PRD Frontend / Daily Check-in)
- Decisions: derive orderedHabits at render time and sort incomplete before completed for immediate move on toggle; keep source habit state unchanged to avoid persistence/API changes.
- Files changed: src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Auth - Invalidate the session on sign out. (PRD Backend / Auth)
- Decisions: verified better-auth sign-out runs through /api/auth with tanstackStartCookies plugin, which clears auth cookie + invalidates session server-side; no custom logout route needed.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Handle partner removal requests and clear partnership data. (PRD Backend / Partnering)
- Decisions: delete all partnerships for requesting user in one query (not first match) so remove request fully clears active partnership data even if duplicate rows exist.
- Files changed: src/db/partnerships.ts, src/lib/api/partnerships.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Display the signed-in user's name in the UI. (PRD Frontend / Auth)
- Decisions: derive greeting from session user.name, fallback to email prefix so greeting still renders when profile name is empty; render in dashboard header as "Hi {name}" to satisfy PRD check intent.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/DashboardHeader.tsx, prd.json, progress.txt.
- Blockers/notes: none.
