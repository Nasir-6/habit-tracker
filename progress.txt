
- Task completed: Frontend / Habit Management - Render habit creation UI with a required name field.
- Decisions: inline creation card on Today page for now; save disabled when trimmed name empty; test script uses --passWithNoTests since no test files.
- Files changed: src/routes/index.tsx, package.json.
- Blockers/notes: vitest reports hanging process message after run.

- Task completed: Backend / Habit Management - Reject habit creation requests without a name.
- Decisions: add POST /api/habits handler with JSON parsing + trimmed name validation; return 201 with name only, no persistence yet.
- Files changed: src/routes/api/habits.ts, src/routeTree.gen.ts.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Calendar View - Display current and best streak above the calendar. (PRD Frontend / Calendar View)
- Decisions: reuse habitStreaks map from dashboard; show current/best cards under selected habit label; default 0 when missing.
- Files changed: src/components/dashboard/HabitCalendarCard.tsx, src/components/dashboard/Dashboard.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Calendar View - Allow navigation between months. (PRD Frontend / Calendar View)
- Decisions: add prev/next month controls in calendar card; shift month anchor to first of month to avoid date drift.
- Files changed: src/components/dashboard/HabitCalendarCard.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / History - Preserve historical data for archived habits. (PRD Backend / History)
- Decisions: added archived_at column for soft-archive; reuse PATCH /api/habits with archiveId to avoid new route; history continues to allow archived habits via existing lookup.
- Files changed: src/db/schema.ts, src/routes/api/habits.ts, drizzle/0005_add_habit_archived_at.sql, drizzle/meta/_journal.json, prd.json, progress.txt.
- Blockers/notes: vitest reports hanging process message after run.

- Task completed: Backend / Calendar View - Return completion dates scoped to habit and month.
- Decisions: add GET /api/calendar with habitId + YYYY-MM; validate month via UTC bounds; query completions within month only.
- Files changed: src/routes/api/calendar.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Habit Management - Allow users to restore an archived habit back to the active list. (PRD Frontend / Habit Management)
- Decisions: prioritized as highest remaining archived-habit integration point before archived-history follow-up; added `restore` as a first-class habit mutation on existing PATCH /api/habits and reused same client mutation path for optimistic archived->active transition.
- Files changed: src/db/habits.ts, src/lib/api/habits.ts, src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList/index.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Habit Management - Display an Archived habits list so users can review archived habits separately from active habits. (PRD Frontend / Habit Management)
- Decisions: prioritized as highest remaining archive-integration item before restore/history follow-ups; expanded habits GET payload to include archived rows and split active vs archived in UI so archived habits render in a dedicated section, not Today list.
- Files changed: src/db/habits.ts, src/lib/api/habits.ts, src/types/dashboard/habit.ts, src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList/index.tsx, prd.json, progress.txt.
- Blockers/notes: feedback loops pass (`npm run typecheck`, `npm run test`, `npm run lint`); vitest still logs hanging-process shutdown warning with 0 tests.

- Task completed: Frontend / Notifications - Allow users to configure per-habit smart reminders (enable/disable and time) and remove a reminder from a habit. (PRD Frontend / Notifications)
- Decisions: prioritized as highest remaining integration point between completed reminder backend actions and habit UI; reused existing PATCH /api/habits actions (`setReminder`/`clearReminder`) to avoid new routes; optimistic query-cache update keeps reminder time feedback immediate.
- Files changed: src/types/dashboard/habit.ts, src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList/index.tsx, src/components/dashboard/HabitList/HabitListItem.tsx, prd.json, progress.txt.
- Blockers/notes: `npm run test` passes (0 tests) but still prints Vitest hanging-process shutdown warning.

- Task completed: Frontend / Partnering - Display a last-updated timestamp for partner habit status data to indicate freshness. (PRD Frontend / Partnering)
- Decisions: prioritized as integration signal between partner-status query freshness and Partner UI; expose TanStack query `dataUpdatedAt` from hook and poll partner status every 60s so timestamp can refresh without manual reload.
- Files changed: src/hooks/usePartnerStatus.ts, src/components/dashboard/PartnerStatusCard/index.tsx, src/components/dashboard/PartnerStatusCard/partnerStatusUtils.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Notifications - Ensure reminder dispatch excludes archived habits and only targets active habits. (PRD Backend / Notifications)
- Decisions: marked complete after verifying reminder dispatcher source query already filters `habits.archived_at IS NULL` and only returns active habits; no code-path expansion to keep change small and avoid duplicate filtering logic.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none; next highest-priority backend reminder work is done, remaining reminder items are PWA/Frontend presentation.

- Task completed: Backend / Habit Management - Strictly purge all smart reminder data when a habit is archived or hard deleted. (PRD Backend / Habit Management)
- Decisions: prioritize reminder-data integrity as core backend abstraction before frontend polish; on archive, always null reminder config and delete prior reminder dispatch claims so archived habits cannot retain reminder state/log history; rely on existing FK cascade for hard-delete purge path.
- Files changed: src/lib/api/habits.ts, src/db/habit-reminder-dispatches.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Notifications - Prevent duplicate smart reminder sends for the same habit and local day. (PRD Backend / Notifications)
- Decisions: prioritized as core reminder-dispatch correctness abstraction; added `habit_reminder_dispatches` claim table with unique `(habit_id, local_date)` and conflict-do-nothing insert so reruns only notify newly claimed reminders; response now reports `skippedAlreadyRemindedCount` for visibility.
- Files changed: src/db/schema.ts, src/db/habit-reminder-dispatches.ts, src/lib/api/reminders.ts, drizzle/0009_create_habit_reminder_dispatches.sql, drizzle/meta/_journal.json, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Notifications - Dispatch Web Push smart reminders for habits when due and still incomplete for the user's local day. (PRD Backend / Notifications)
- Decisions: prioritized as highest-risk core integration (reminder schedule + completion state + push delivery); added authenticated dispatch endpoint `POST /api/reminders` with optional `tzOffsetMinutes` + `nowIso` for deterministic local-day due checks; due set uses active habits with `reminderTime <= local HH:MM` and skips habits already completed on computed local date.
- Files changed: src/db/habits.ts, src/lib/api/reminders.ts, src/routes/api/reminders.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: duplicate-send prevention per habit/day intentionally deferred to separate PRD item.

- Task completed: Backend / Habit Management - Persist per-habit smart reminder settings and support explicit reminder removal. (PRD Backend / Habit Management)
- Decisions: prioritized as highest remaining core backend abstraction for upcoming reminder dispatch; extended existing PATCH /api/habits actions with `setReminder` and `clearReminder` to avoid route sprawl; persisted reminder as nullable `reminder_time` (`HH:MM`) and exposed in habits query payload for downstream UI/dispatcher integration.
- Files changed: src/db/schema.ts, src/db/habits.ts, src/lib/api/habits.ts, drizzle/0008_add_habit_reminder_time.sql, drizzle/meta/_journal.json, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Habit Management - Support both archive and hard delete operations for habits with clear, separate semantics. (PRD Backend / Habit Management)
- Decisions: made PATCH /api/habits support explicit mutation actions (`archive` | `hardDelete`) with `habitId`; kept legacy `archiveId` payload path for compatibility; standardized mutation responses with `operation` so archive vs hard delete outcome is unambiguous; ignored generated `.output`/`.netlify` artifacts in ESLint so required feedback loops can run in dirty local builds.
- Files changed: src/lib/api/habits.ts, eslint.config.js, prd.json, progress.txt.
- Blockers/notes: none; frontend two-step delete flow can now call action-based API without backend contract changes.

- Task completed: Frontend / Partnering - Show explicit in-app feedback to inviters when sent invites are accepted, rejected, or cancelled. (PRD Frontend / Partnering)
- Decisions: prioritized this remaining partnering integration item over empty-state/timestamp polish; detect sent-invite outcome transitions client-side from pending->accepted/rejected/cancelled using invite + partner status query changes, no backend schema/API expansion.
- Files changed: src/hooks/usePartnerStatus.ts, src/components/dashboard/PartnerStatusCard/index.tsx, prd.json, progress.txt.
- Blockers/notes: `npm run test` exits 0 with no tests but still prints Vitest hanging-process shutdown warning.

- Task completed: Frontend / Notifications - Show in-app nudge banner when the app is currently visible and focused. (PRD Frontend / Notifications)
- Decisions: prioritize as integration point between SW push runtime and foreground UI; in SW push handler, if any visible+focused app client exists send `postMessage` banner payload and skip system notification to prevent duplicates; render lightweight auto-dismiss in-app banner from service worker message events in dashboard.
- Files changed: public/sw.js, src/components/dashboard/InAppNudgeBanner.tsx, src/components/dashboard/Dashboard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Show nudge cooldown state in UI and prevent repeated nudge taps during cooldown. (PRD Frontend / Partnering)
- Decisions: prioritized as integration point between nudge rate-limit API and partner UI; switched nudge mutation to parse cooldown metadata (`retryAfterSeconds` / `limits.cooldownSeconds`) so UI can lock button on both success and 429 cooldown; countdown kept client-side with 1s interval to avoid extra polling.
- Files changed: src/hooks/usePartnerStatus.ts, src/components/dashboard/PartnerStatusCard/index.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Display the active partner name in the partner habits heading instead of a generic Partner label. (PRD Frontend / Partnering)
- Decisions: prioritized as cross-module integration (partner API payload + UI heading) over polish-only items; derive display name from partner email local-part to avoid schema migration for profile names.
- Files changed: src/db/partnerships.ts, src/lib/api/partnerships.ts, src/hooks/usePartnerStatus.ts, src/components/dashboard/PartnerStatusCard/partnerStatusUtils.ts, src/components/dashboard/PartnerStatusCard/PartnerStatusHeader.tsx, src/components/dashboard/PartnerStatusCard/index.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Allow users to send a generic nudge to an active partner from the Partner section. (PRD Frontend / Partnering)
- Decisions: add nudge action only in active partner state and wire to POST /api/nudges; surface backend cooldown/limit errors inline via shared requestApi message path; keep scope to send + confirmation (cooldown UI/timestamps handled in later PRD items).
- Files changed: src/hooks/usePartnerStatus.ts, src/components/dashboard/PartnerStatusCard/index.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Show rejected sent invites to the inviter with clear rejected status. (PRD Frontend / Partnering)
- Decisions: add explicit status pill in sent invites row; use red rejected vs neutral pending styling so outcome is scannable without opening invite detail.
- Files changed: src/components/dashboard/PartnerStatusCard/PartnerSentInvites.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Allow inviters to clear rejected invites without affecting active partnerships. (PRD Backend / Partnering)
- Decisions: widened inviter delete filter to allow pending+rejected statuses only; kept accepted/partnership records untouched to avoid side effects.
- Files changed: src/db/partner-invites.ts, src/lib/api/partner-invites.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Persist session across refresh when the user is signed in. (PRD Frontend / Auth)
- Decisions: force one client-side session refetch on app mount; avoids stale SSR-null auth snapshot after hard refresh; keeps existing auth flow unchanged.
- Files changed: src/routes/index.tsx, prd.json, progress.txt.
- Blockers/notes: vitest still prints hanging-process shutdown warning though command exits 0.

- Task completed: Frontend / Partnering - Allow users to remove an active partner from the UI. (PRD Frontend / Partnering)
- Decisions: add remove action in active partner card with confirm guard; call existing DELETE /api/partnerships and clear local partner state immediately on success; keep inline success/error copy for user feedback.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/PartnerStatusCard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Auth - Create a session on successful sign-in. (PRD Backend / Auth)
- Decisions: confirmed better-auth handler + tanstackStartCookies handles session creation on sign-in; no extra server route needed.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Allow users to create an account with email and password. (PRD Frontend / Auth)
- Decisions: explicitly sign in after successful sign-up to ensure session and dashboard load immediately.
- Files changed: src/routes/index.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Render sign-in screen with email and password inputs. (PRD Frontend / Auth)
- Decisions: disable auth submit when email or password empty; keep existing auth submit validation for error messaging.
- Files changed: src/components/dashboard/AuthScreen.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Partnering - Display partner habit names and todayâ€™s completion status. (PRD Frontend / Partnering)
- Decisions: fetch partner status from /api/partnerships using local date; treat 404 as no partner; show completed pill per habit.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/PartnerStatusCard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / History - Render a read-only history view for a habit. (PRD Frontend / History)
- Decisions: inline per-habit history panel vs new route to avoid route tree changes; fetch on-demand from /api/history with today localDate; render dates as read-only YYYY-MM-DD pills.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Restrict partner visibility to post-partnership data only.
- Decisions: add GET /api/partnerships returning partner habits + today status; gate completion status when localDate < partnership startedOn; keep habit names visible regardless of start date.
- Files changed: src/routes/api/partnerships.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Calendar View - Ensure calendar data respects user local timezone.
- Decisions: accept optional tzOffsetMinutes query param (defaults 0); shift habit created/today bounds by offset; validate integer +/-14h.
- Files changed: src/routes/api/calendar.ts, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / Partnering - Allow either user to revoke partnership immediately.
- Decisions: add DELETE /api/partnerships to remove the current user's partnership by matching user id on either side; return 404 when none found.
- Files changed: src/routes/api/partnerships.ts, src/routes/api/streaks.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Activate partnership upon acceptance.
- Decisions: add partnerships table keyed by sorted user ids with started_at timestamp; accept via PATCH /api/partner-invites using inviteId, verify invitee email matches session user.
- Files changed: src/routes/api/partner-invites.ts, src/db/schema.ts, drizzle/0004_create_partnerships.sql, drizzle/meta/_journal.json, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Create a pending partnership invite.
- Decisions: add partner_invites table with pending status + unique inviter/invitee/status; POST /api/partner-invites validates email, prevents self-invite, onConflictDoNothing -> "Invite already pending".
- Files changed: src/db/schema.ts, drizzle/0003_create_partner_invites.sql, drizzle/meta/_journal.json, src/routes/api/partner-invites.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Streaks - Display current and best streak per habit.
- Decisions: fetch streaks per habit from /api/streaks using local YYYY-MM-DD; store streaks in separate map to avoid mutating habit list; default to 0 on fetch error.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / History - Return historical completion data for a habit.
- Decisions: add GET /api/history with habitId + localDate query; validate localDate and exclude future by lte on completedOn; return ordered date list.
- Files changed: src/routes/api/history.ts, src/routeTree.gen.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Habit Management - Allow reordering of habits via drag-and-drop.
- Decisions: HTML5 drag events with optimistic reorder; persist order via PATCH /api/habits; rollback on error; reuse error banner.
- Files changed: src/routes/index.tsx.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Daily Check-in - Allow user to undo a habit completion for the current day.
- Decisions: toggle completion in local state; keep button active with undo label and completed styling.
- Files changed: src/routes/index.tsx.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Habit Management - Display newly created habits in the Today list.
- Decisions: submit to /api/habits and render response into local habit list; prepend new habit; show empty/drag hints conditionally; add lightweight error state.
- Files changed: src/routes/index.tsx.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Daily Check-in - Allow user to complete a habit for the current day.
- Decisions: store completion state in local habit list; disable completion control once marked to avoid undo in this task scope.
- Files changed: src/routes/index.tsx.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / Habit Management - Persist habit order per user.
- Decisions: add habits table with sort order + user id; require auth session for habit CRUD; add GET/PATCH on /api/habits for ordered fetch and updates.
- Files changed: src/db/schema.ts, src/routes/api/habits.ts.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Auth + DB plumbing - Enable email/password auth flow and apply habits table migration for local testing.
- Decisions: use absolute auth base URL on SSR and window origin on client; add habits migration and update journal for db:migrate.
- Files changed: src/lib/auth-client.ts, src/routes/index.tsx, drizzle/0001_create_habits.sql, drizzle/meta/_journal.json.
- Blockers/notes: none.

- Task completed: Backend / Streaks - Calculate current streak from consecutive daily completions.
- Decisions: new GET /api/streaks with habitId/localDate query; streak counts consecutive completions ending on provided localDate to zero-out missed days.
- Files changed: src/routes/api/streaks.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Daily Check-in - Remove or deactivate completion when undone.
- Decisions: add DELETE /api/completions with same payload validation + habit ownership check; return removed boolean after delete.
- Files changed: src/routes/api/completions.ts, prd.json.
- Blockers/notes: none.

- Task completed: Backend / Daily Check-in - Store a single completion per habit per local day.
- Decisions: create habit_completions table with unique (habit_id, completed_on); POST /api/completions expects habitId + localDate (YYYY-MM-DD), validates date, uses conflict-do-nothing to prevent duplicates.
- Files changed: src/db/schema.ts, src/routes/api/completions.ts, drizzle/0002_create_habit_completions.sql, drizzle/meta/_journal.json, prd.json.
- Blockers/notes: none.

- Task completed: Backend / Streaks - Reset current streak after a missed day while preserving best streak.
- Decisions: compute bestStreak from descending completion list while currentStreak continues to anchor on requested localDate; return bestStreak from /api/streaks response.
- Files changed: src/routes/api/streaks.ts, prd.json.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Backend / Calendar View - Exclude dates before habit creation and after today.
- Decisions: clamp calendar query bounds between habit created date (UTC) and today (UTC) to avoid pre-creation/future dates; return empty list when range is invalid.
- Files changed: src/routes/api/calendar.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Habit Management - Reject habit creation requests without a name. (PRD Backend / Habit Management)
- Decisions: confirmed existing POST /api/habits validation already rejects missing/blank names before insert; marked PRD as passing.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Calendar View - Render a monthly calendar for a single habit. (PRD Frontend / Calendar View)
- Decisions: replace week preview card with calendar card; default to current month and first habit selection; show empty state when no habits.
- Files changed: src/components/dashboard/HabitCalendarCard.tsx, src/components/dashboard/Dashboard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Calendar View - Visually distinguish completed, missed, today, and future days. (PRD Frontend / Calendar View)
- Decisions: fetch calendar dates via /api/calendar with tzOffsetMinutes for local day mapping; derive status per YYYY-MM-DD and apply distinct Tailwind styles for completed/missed/today/future.
- Files changed: src/components/dashboard/HabitCalendarCard.tsx, prd.json, progress.txt.
- Blockers/notes: vitest hanging process message persists after run.

- Task completed: Frontend / Platform - Ensure Today screen is usable on mobile viewports. (PRD Frontend / Platform)
- Decisions: added responsive padding + stacked layout; increased touch target sizes with min height and full-width buttons on small screens; hide Empty label when habits exist.
- Files changed: src/components/dashboard/PageShell.tsx, src/components/dashboard/CreateHabitCard.tsx, src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: vitest still reports hanging process message after run.

- Task completed: Backend / Platform - Support offline completions with eventual sync. (PRD Backend / Platform)
- Decisions: allow bulk completion payloads on POST /api/completions; rely on conflict-do-nothing to keep sync idempotent; validate habit ownership across batch before insert.
- Files changed: src/routes/api/completions.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Habit Management - Allow reordering of habits via drag-and-drop. + Backend / Habit Management - Persist habit order per user. (PRD updates)
- Decisions: mark PRD items as passing to reflect completed implementation already in repo.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Provide a visible sign-out action when a user is signed in. + Sign out clears session and returns user to the sign-in view. (PRD Frontend / Auth)
- Decisions: wire dashboard header sign-out to authClient.signOut with in-progress and inline error state; reset sign-out state on logout.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/DashboardHeader.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Auth - Restrict protected API routes to authenticated users. (PRD Backend / Auth)
- Decisions: confirmed all API routes use withAuth and session lookup via auth.api.getSession to return 401 when unauthenticated.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Auth - Reject sign-in with invalid credentials. (PRD Backend / Auth)
- Decisions: better-auth handler validates credentials and returns error on failed sign-in; no extra server route required.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Allow users to invite a partner from the UI. (PRD Frontend / Partnering)
- Decisions: add invite form to Partner card when no active partner; submit to existing /api/partner-invites endpoint; show inline success/error confirmation to close loop after submit.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/PartnerStatusCard.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Habit Management - Delete a habit and its related data on request. (PRD Backend / Habit Management)
- Decisions: added DELETE /api/habits with habitId query for explicit intent; hard-delete habit row scoped by user and rely on FK cascade from habit_completions for related cleanup.
- Files changed: src/db/habits.ts, src/lib/api/habits.ts, src/routes/api/habits.ts, prd.json, progress.txt.
- Blockers/notes: vitest still prints hanging-process shutdown warning though command exits 0.

- Task completed: Frontend / Habit Management - Allow users to delete a habit from the UI. (PRD Frontend / Habit Management)
- Decisions: add inline Delete action per habit instead of a menu for minimal surface; require native confirm prompt before DELETE /api/habits; clear open history panel if deleted habit was selected.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Daily Check-in - Move completed habits to the bottom of the Today list. (PRD Frontend / Daily Check-in)
- Decisions: derive orderedHabits at render time and sort incomplete before completed for immediate move on toggle; keep source habit state unchanged to avoid persistence/API changes.
- Files changed: src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Auth - Invalidate the session on sign out. (PRD Backend / Auth)
- Decisions: verified better-auth sign-out runs through /api/auth with tanstackStartCookies plugin, which clears auth cookie + invalidates session server-side; no custom logout route needed.
- Files changed: prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Handle partner removal requests and clear partnership data. (PRD Backend / Partnering)
- Decisions: delete all partnerships for requesting user in one query (not first match) so remove request fully clears active partnership data even if duplicate rows exist.
- Files changed: src/db/partnerships.ts, src/lib/api/partnerships.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Auth - Display the signed-in user's name in the UI. (PRD Frontend / Auth)
- Decisions: derive greeting from session user.name, fallback to email prefix so greeting still renders when profile name is empty; render in dashboard header as "Hi {name}" to satisfy PRD check intent.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/DashboardHeader.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Daily Check-in - Render a strikethrough style for habits completed today. (PRD Frontend / Daily Check-in)
- Decisions: apply line-through + muted text only when habit marked completed; keep status copy/buttons unchanged to keep behavior scoped to visual requirement.
- Files changed: src/components/dashboard/HabitList.tsx, prd.json, progress.txt.
- Blockers/notes: vitest still prints hanging-process shutdown warning though command exits 0.

- Task completed: Frontend / Auth - Display auth errors inline for failed sign-in or sign-up. (PRD Frontend / Auth)
- Decisions: normalize fallback auth error copy by mode (sign-in vs sign-up) to keep failures explicit; clear stale auth errors on input edits so inline message reflects latest attempt; use role=alert for inline error accessibility.
- Files changed: src/routes/index.tsx, src/components/dashboard/AuthScreen.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Support rejecting an invite by transitioning status from pending to rejected for the invitee only. (PRD Backend / Partnering)
- Decisions: add PATCH action `reject` in existing partner-invites endpoint to avoid new route; enforce invitee ownership via existing email/id checks before status update; update invite row status to `rejected` (not delete) so later inviter-facing flows can read outcome.
- Files changed: src/lib/api/partner-invites.ts, src/db/partner-invites.ts, src/hooks/usePartnerStatus.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Include rejected sent invites in inviter-facing invite responses. (PRD Backend / Partnering)
- Decisions: keep pending-only query for create-flow guardrails; add separate inviter sent-invites query including pending + rejected so response contract expands without weakening one-pending limit.
- Files changed: src/db/partner-invites.ts, src/lib/api/partner-invites.ts, src/types/dashboard/partner.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Allow invited users to reject a pending partner invite from the UI. (PRD Frontend / Partnering)
- Decisions: add explicit Reject action beside Accept on pending invite rows; reuse existing PATCH /api/partner-invites action=reject path to avoid new endpoint/state shape; disable both actions while either mutation runs to prevent duplicate submits.
- Files changed: src/components/dashboard/PartnerStatusCard/PartnerPendingInvites.tsx, src/components/dashboard/PartnerStatusCard/index.tsx, src/hooks/usePartnerStatus.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Allow inviters to resend a rejected invite from the sent invites list. (PRD Frontend / Partnering)
- Decisions: add resend action only on rejected sent invites; reuse existing POST /api/partner-invites with invitee email from selected rejected invite; track per-row resending state to prevent duplicate submit and keep delete disabled during resend.
- Files changed: src/components/dashboard/PartnerStatusCard/PartnerSentInvites.tsx, src/components/dashboard/PartnerStatusCard/index.tsx, src/hooks/usePartnerStatus.ts, prd.json, progress.txt.
- Blockers/notes: clear-rejected action still pending for next iteration.

- Task completed: Frontend / Partnering - Allow inviters to clear a rejected invite from their sent invites list. (PRD Frontend / Partnering)
- Decisions: keep one sent-invite delete mutation path, but derive invite status client-side so rejected rows use explicit Clear affordance/copy; preserve same backend action to avoid API surface growth for a UI-only distinction.
- Files changed: src/components/dashboard/PartnerStatusCard/PartnerSentInvites.tsx, src/hooks/usePartnerStatus.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Prevent duplicate cross-invites when opposite-direction pending invite already exists. (PRD Backend / Partnering)
- Decisions: resolve invite target user by email, then check pending invite in reverse direction (target->current user) before insert; reject with explicit conflict message so users accept/reject existing invite instead of creating duplicate pair.
- Files changed: src/db/schema.ts, src/db/partner-invites.ts, src/lib/api/partner-invites.ts, prd.json, progress.txt.
- Blockers/notes: npm run test passes with 0 tests but still prints Vitest hanging-process shutdown warning.

- Task completed: Backend / Partnering - Return only active non-deleted habits in partner habit list responses. (PRD Backend / Partnering)
- Decisions: filter partner habit query to `archived_at IS NULL` so only active habits are exposed; keep hard-deleted behavior unchanged since deleted rows are already excluded.
- Files changed: src/db/partnerships.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Reject partner invites where the target email matches the inviter email. (PRD Backend / Partnering)
- Decisions: enforce self-invite rejection by resolved target user id (not only email string compare), so validation still holds if session email is missing/non-normalized; keep existing error copy.
- Files changed: src/lib/api/partner-invites.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Partnering - Create and persist partner nudge events for active partnerships only. (PRD Backend / Partnering)
- Decisions: added POST /api/nudges that derives receiver from active partnership only (no client-provided target); persist nudge row with sender/receiver/timestamp for later cooldown/notification work.
- Files changed: src/db/schema.ts, src/db/nudges.ts, src/lib/api/nudges.ts, src/routes/api/nudges.ts, src/routeTree.gen.ts, drizzle/0006_create_partner_nudges.sql, drizzle/meta/_journal.json, prd.json, progress.txt.
- Blockers/notes: rate limits + push delivery still pending in later nudge/notification PRD items.

- Task completed: Backend / Partnering - Enforce nudge cooldown and daily rate limits with clear API error messages. (PRD Backend / Partnering)
- Decisions: enforce limits server-side in POST /api/nudges before insert; use 15m cooldown + 10/day UTC cap; return 429 with explicit code/message + retry metadata so UI can lock/retry predictably.
- Files changed: src/lib/api/nudges.ts, src/db/nudges.ts, prd.json, progress.txt.
- Blockers/notes: vitest still prints hanging-process shutdown warning though command exits 0.

- Task completed: Backend / Notifications - Store and manage Web Push subscriptions per authenticated user. (PRD Backend / Notifications)
- Decisions: add dedicated push_subscriptions table with soft-deactivate (`deleted_at`) so unsubscribe is reversible/prunable; use endpoint-unique upsert keyed by endpoint to rebind stale subscriptions to current authenticated user safely; register @typescript-eslint plugin in eslint flat config so repo lint loop can run successfully.
- Files changed: src/db/schema.ts, src/db/push-subscriptions.ts, src/lib/api/push-subscriptions.ts, src/routes/api/push-subscriptions.ts, src/routeTree.gen.ts, drizzle/0007_create_push_subscriptions.sql, drizzle/meta/_journal.json, eslint.config.js, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Backend / Notifications - Send Web Push notification to partner when a nudge is created. (PRD Backend / Notifications)
- Decisions: trigger push dispatch in POST /api/nudges after successful nudge insert; treat 404/410 push responses as stale subscriptions and soft-deactivate them; keep nudge API success even if push dispatch fails to avoid blocking sender flow.
- Files changed: src/lib/api/nudges.ts, package.json, package-lock.json, prd.json, progress.txt.
- Blockers/notes: `npm run test` exits 0 with no tests but still prints Vitest hanging-process shutdown warning.

- Task completed: Frontend / Partnering - Display incoming invite labels using inviter name and email instead of raw user ID. (PRD Frontend / Partnering)
- Decisions: include inviter email in pending invite payload via user join; derive display name from email local-part for label format `Invite from Name (email)`; keep user-id fallback only when email is unavailable.
- Files changed: src/db/partner-invites.ts, src/types/dashboard/partner.ts, src/components/dashboard/PartnerStatusCard/partnerStatusUtils.ts, src/components/dashboard/PartnerStatusCard/PartnerPendingInvites.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: PWA / Platform - Configure the app as an installable PWA with service worker and web app manifest. (PRD PWA / Platform)
- Decisions: selected PWA baseline first as highest-priority architecture dependency for notification delivery; register `/sw.js` from root route so all screens run under one worker scope; keep service worker minimal (`install`/`activate`) for installability without adding cache policy risk.
- Files changed: src/routes/__root.tsx, public/manifest.json, public/sw.js, eslint.config.js, prd.json, progress.txt.
- Blockers/notes: `npm run test` exits 0 with no tests but still logs Vitest hanging-process shutdown warning.

- Task completed: Frontend / Notifications - Request notification permission and register Web Push subscription for signed-in users. (PRD Frontend / Notifications)
- Decisions: prioritize this next as highest-value integration point between PWA service worker, push-subscription backend, and upcoming nudge notification UX; add one-click enable flow with permission request -> VAPID config fetch -> push subscribe -> POST register; show explicit blocked/unsupported/error states for denied permission loop.
- Files changed: src/components/dashboard/NotificationPermissionCard.tsx, src/components/dashboard/Dashboard.tsx, src/lib/api/push-subscriptions.ts, src/routes/api/push-subscriptions.ts, prd.json, progress.txt.
- Blockers/notes: `npm run test` exits 0 (no tests) but still prints Vitest hanging-process shutdown warning.

- Task completed: PWA / Notifications - Show system notification for nudges when app is hidden, in another tab, minimized, or closed. (PRD PWA / Notifications)
- Decisions: prioritize this as highest-risk integration point between backend push payloads and service worker runtime; add push event handler with safe payload parsing/fallback title-body and notificationclick handler to focus existing app window or open `/` when closed.
- Files changed: public/sw.js, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Display incoming nudges in-app with sender name and relative timestamp. (PRD Frontend / Partnering)
- Decisions: prioritized as integration point between nudge events and partner UI; reused existing partner-status fetch to include latest incoming nudge timestamp (no extra client polling endpoint); sender name derived from active partner email display-name convention to avoid profile schema changes.
- Files changed: src/db/nudges.ts, src/lib/api/partnerships.ts, src/hooks/usePartnerStatus.ts, src/components/dashboard/PartnerStatusCard/index.tsx, src/components/dashboard/PartnerStatusCard/partnerStatusUtils.ts, src/types/dashboard/partner.ts, src/types/dashboard/index.ts, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: Frontend / Partnering - Show a clear in-app state when a partner removes the current user. (PRD Frontend / Partnering)
- Decisions: prioritized as partner-state integration risk; detect `hasPartner` transition true->false after successful partner-status refetch and show explicit ended-partnership guidance; suppress this notice for self-removal path by honoring existing remove-partner confirmation notice.
- Files changed: src/hooks/usePartnerStatus.ts, src/components/dashboard/PartnerStatusCard/index.tsx, prd.json, progress.txt.
- Blockers/notes: none.

- Task completed: PWA / Notifications - Show habit-specific smart reminder push content and open the app when the notification is clicked. (PRD PWA / Notifications)
- Decisions: prioritized as highest remaining cross-module integration point (reminder dispatcher payload -> service worker UX); branched SW behavior by push `type` so nudge foreground suppression stays nudge-only while reminder pushes consistently show system notifications with habit-specific fallback copy; on notification click navigate existing app tab to payload url before focus to guarantee open/focus behavior.
- Files changed: src/lib/api/reminders.ts, public/sw.js, prd.json, progress.txt.
- Blockers/notes: `npm run test` exits 0 (no tests) but still logs Vitest hanging-process shutdown warning.

- Task completed: Frontend / Habit Management - Replace the inline create-habit card with a floating plus action button that opens a create-habit modal. (PRD Frontend / Habit Management)
- Decisions: prioritize this as create-flow UI foundation for remaining modal-related items; reuse existing create mutation and validation, move entry point to fixed FAB + modal to avoid backend/API changes.
- Files changed: src/components/dashboard/CreateHabitCard.tsx, prd.json, progress.txt.
- Blockers/notes: feedback loops pass (`npm run typecheck`, `npm run test`, `npm run lint`); vitest still logs hanging-process shutdown warning with 0 tests.

- Task completed: Frontend / Habit Management - Provide a two-step delete flow that lets users choose Archive (keep history) or Delete forever (permanent removal). (PRD Frontend / Habit Management)
- Decisions: prioritized as highest remaining integration point between existing archive vs hard-delete backend actions and habit UI; first modal now offers Archive vs Delete forever, and hard delete requires a second irreversible confirm before PATCH action `hardDelete`.
- Files changed: src/routes/index.tsx, src/components/dashboard/Dashboard.tsx, src/components/dashboard/HabitList/index.tsx, prd.json, progress.txt.
- Blockers/notes: none.
